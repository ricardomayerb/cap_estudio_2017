---
title: "Agrupando condiciones macro en AL"
author: "Ricardo Mayer"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  html_document:
    code_folding: hide
    number_sections: yes
    toc: yes
    toc_depth: 3
  pdf_document: default
  word_document: default
params:
  end_year: 2015
  start_year: 1990
  is_html: TRUE
  dygraphs_plots: TRUE
  ggplot2_plots: TRUE
always_allow_html: yes
---

<!-- https://cpsievert.github.io/plotly_book/index.html -->


```{r knit_config, include=FALSE}

knitr::opts_knit$set(root.dir = "./../")
knitr::opts_chunk$set(echo = FALSE)

```



```{r libs_dicts_country_sel, include = FALSE}
library(printr)
library(plotly)
library(dygraphs)
library(tidyr)
library(dplyr)
library(tibble)
library(ggplot2)
library(gridBase)
library(gridExtra)
library(stringr)
library(stringi)
library(DT)
library(lubridate)
library(ineq)
library(knitr)
library(xts)
# library(purrr)

library(xtable)
options(xtable.floating = FALSE)
options(xtable.timestamp = "")
options(width = 60)
options(digits = 3)
mr_year <- params$end_year

default_time_break <- as.Date("2007-12-31", format = "%Y-%m-%d") 

# time_breaks = 2001

# pre_path <- "~/GitHub/cap_estudio_2017/"
pre_path <- 'V:/USR/RMAYER/cw/cap_estudio_2017/'

source(paste0(pre_path, "functions/cate_dext.R"))

load(paste0(pre_path, "produced_data/cepal_19_countries"))
load(paste0(pre_path, "produced_data/cepal_33_countries"))

coi_19 <- cepal_19_countries$iso3c
coi_18 <- coi_19[-which(coi_19 %in% c("CUB"))]
coi_18_minus_br_mx_ven <-  coi_18[-which(coi_18 %in% c("BRA", "MEX", "VEN"))]
coi_sa <-  c("ARG", "BOL" ,"BRA", "CHL", "COL", "ECU",  "PER", "PRY", "URY", "VEN")
coi_sa_minus_BRA_VEN <- coi_sa[-which(coi_sa %in% c("BRA","VEN"))]
coi_ca <-  c("CRI", "DOM", "HND" ,"GTM", "PAN", "NIC", "SLV", "MEX")
coi_ca_minus_mex <- coi_ca[-which(coi_ca %in% c("MEX"))]

coi <- coi_sa_minus_BRA_VEN

load(paste0(pre_path, 
            "produced_data/data_with_basic_wrangling/monetary_fin_tidy"))

load(paste0(pre_path, 
            "produced_data/data_with_basic_wrangling/cs_gdp_currentlc_q_gasto"))

load(paste0(pre_path, 
            "produced_data/data_with_basic_wrangling/cs_deuda_externa"))

load(paste0(pre_path, 
            "produced_data/data_with_basic_wrangling/cs_sector_publico"))

```



# Debt
## Total external debt 

```{r ext_debt_make_dfs, echo=FALSE}
# make tibble for future tables and plots

dext_to_gdp <- cs_deuda_externa %>% 
  filter(str_detect(indicador, "porcentaje")) %>% 
  rename(deuda_ext_porc_pib = valor) %>% 
  select(iso3c, year, deuda_ext_porc_pib) %>% 
  mutate(year = as.Date(as.character(year), format = "%Y"))

```

### Latin America {.tabset}

Salient features, 1990-2015: 

+  Con la excepción de **Nicaragua**, que termina el período de guerra viene saliendo del conflicto 
armado con la Contra, ALC comienza la década de los nos noventa con niveles relativamente altos pero manejables de aueda externa. Se observa sin embargo baste dispersipo en los valores de este ratio.

+  En general los noventa son un período de reducción de deuda bruta. Coincidiendo con la crisis Asiática de 1997-1998, la tendencia más común en ALC es a aumentar la razón deuda/pib, lo que es especialmente agudo en los casos de **Argentina, Uruguay y Venezuela** y en menor medida, en **Honduras** y **El Salvador**. 

+  En los años posteriores a la crisis financiera del 2007-2008, vemos nuevamente un aumento pero mucho más moderado de la deuda externa como porcentaje del PIB, con la notable excepción de Venezuela que redujo sostenidamente este ratio, siendo casos similares de reducción pero más moderados, **Panamá** y **Nicaragua**. 

+  Es evidente  la menor dispersión del ratio deuda a PIB en los últimos 10-12 años,  comparados con el período previo al 2003. Aunque, mirando con más detalle, la mayor compresión se alcanza el 2011 y luego comienza a aumetar la dispersión, especialmente por el aumento de **Chile** y caída de **Venezuela**.


Salient features, 2008-2015: 

+  Los países con mayor ratio, Chile, Nicaragua, El Salvador y Uruguay, han ido 
incrementando aún mas su endeudamiento bruto, excepto Nicaragua.

+ Argentina, Venezuela y Nicaragua se desprenden del grupo porque muestran una tedencia a la dismiución de la deuda.

+ En los dos cuartiles de mayor endeudameinto bruto hay una presencia mixta de países de centro y sudamérica


```{r ext_debt_make_dfs_18, include=TRUE}
dext_time_break <- as.Date("2007-12-31", format = "%Y-%m-%d")

dext_to_gdp_18 <- dext_to_gdp %>% 
  filter(iso3c %in% coi_18)

dext_to_gdp_18_xts <- cate_gen_to_xts_wide(dext_to_gdp_18, 
                                            is_full = TRUE, 
                                            is_med = FALSE,
                                            value_col_name = "deuda_ext_porc_pib",
                                            dating_col_name = "year")

dext_18_class_pct4_1990_2015 <- cate_gen(dext_to_gdp_18,
                                          is_med = FALSE, is_pct3 = FALSE,
                                          is_pct4 = TRUE,
                                            value_col_name = "deuda_ext_porc_pib",
                                            dating_col_name = "year")

dext_18_class_pct4_1990_2001_2015 <- cate_gen(dext_to_gdp_18,
                                               time_breaks = dext_time_break,
                                               is_med = FALSE, 
                                               is_pct4 = TRUE,
                                            value_col_name = "deuda_ext_porc_pib",
                                            dating_col_name = "year")

dext_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(dext_18_class_pct4_1990_2015,
                                                      is_med = FALSE,
                                                      is_pct4 = TRUE,
                                            value_col_name = "deuda_ext_porc_pib",
                                            dating_col_name = "year")

dext_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(dext_18_class_pct4_1990_2001_2015[[1]],
                                                      is_med = FALSE,
                                                      is_pct4 = TRUE,
                                            value_col_name = "deuda_ext_porc_pib",
                                            dating_col_name = "year")

dext_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(dext_18_class_pct4_1990_2001_2015[[2]],
                                                      is_med = FALSE,
                                                      is_pct4 = TRUE,
                                            value_col_name = "deuda_ext_porc_pib",
                                            dating_col_name = "year")
```

#### All countries

```{r ext_debt_make_dygraph_18, eval=params$dygraphs_plots}
dext_title_18 <- "(Gross) External debt, as % of GDP (E18)"

dg_18 <- dygraph(dext_to_gdp_18_xts, main = dext_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dg_18

```


  
  


#### By quartiles of External Debt to GDP



En la submuestra de años 2009 a 2015, calcule el promedio de deuda/pib de cada país y compárelo 
con los promedios del resto de los países. Ordene a los países en cuartiles, dependiendo de su nivel de deuda promedio en este período




```{r ext_debt_make_dygraph_18_pct4_period2, eval=params$dygraphs_plots}

dg_title_quartile_1  <- "Primer cuartil de Deuda/PIB (el más bajo)"
dg_title_quartile_2  <- "Segundo cuartil de Deuda/PIB"
dg_title_quartile_3  <- "Tercer cuartil de Deuda/PIB"
dg_title_quartile_4  <- "Cuarto cuartil de Deuda/PIB (el más alto)"


dg_18_pct4_b25_2001_period2 <- dygraph(dext_18_pct4_1990_2001_2015_xts_2[["below_p25"]], main = dg_title_quartile_1) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dg_18_pct4_25_to_50_2001_period2 <- dygraph(dext_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]], main = dg_title_quartile_2) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dg_18_pct4_50_to_75_2001_period2 <- dygraph(dext_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]], main = dg_title_quartile_3) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dg_18_pct4_a75_2001_period2 <- dygraph(dext_18_pct4_1990_2001_2015_xts_2[["above_p75"]], main = dg_title_quartile_4) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dg_18_pct4_a75_2001_period2

dg_18_pct4_50_to_75_2001_period2

dg_18_pct4_25_to_50_2001_period2

dg_18_pct4_b25_2001_period2

```


Same plots, in a 2x2 array


```{r ext_debt_make_ggplot_18_pct4_period2, echo=FALSE}

by_gen_groups <- dext_18_class_pct4_1990_2001_2015[[2]] %>% 
  arrange(desc(avg_value)) %>% 
  group_by(gen_group) %>% 
  nest() 

plots_gen_group <- by_gen_groups %>% 
  mutate(gruplot = purrr::map(data , ~ ggplot(data = ., aes(x=year, y=deuda_ext_porc_pib, col=iso3c)) +  geom_line()  ))

# all_plots <- grid.arrange(grobs = plots_gen_group$gruplot, ncol = 2,
#                           main = "Quartiles of external debt/gdp")

multiplot(plotlist = plots_gen_group$gruplot, cols = 2)
```



## Public debt, domestic and external:


```{r secpub_debt_make_dfs, echo=FALSE }
# sp_data <- cs_sector_publico %>% 
#   filter(iso3c %in% coi_33) %>% 
#   filter(year <= params$end_year) 

sp_deuda_porc_pib <- cs_sector_publico %>% 
  filter(`Cobertura institucional_2` != "n/a") %>%
  filter( str_detect(indicador, "porcentajes")) %>% 
  rename(cobertura =  `Cobertura institucional_2`) %>% 
  select(-c(`Tipo de persona`, Periodo, `Tasa mínima/máxima`, Periodo_1,
            `Clasificación económica Operaciones del gobierno`, 
            `Cobertura institucional_1`, `Cobertura institucional`,
            Clasificacion_impuestos)) %>% 
  rename(deuda_publica_porc_pib = valor, clasificacion_deuda = Clasificación_deuda) %>% 
  mutate(clasificacion_deuda = str_to_lower(clasificacion_deuda) %>% 
           str_replace_all(" ", "_") %>% stri_trans_general("Latin-ASCII") %>% 
           str_replace_all("\\(", "_") %>% str_replace_all("\\)", "_")
  ) %>% 
  filter(!duplicated(.[ , 1:5])) %>%  
  spread(clasificacion_deuda, deuda_publica_porc_pib) %>%
  rename(total_p = total_deuda_publica__clasificacion_por_residencia_,
         externa_p = deuda_externa,
         interna_p = deuda_interna) %>% 
  mutate(year = as.Date(as.character(year), format = "%Y"))

gcentral_deuda_pib <- sp_deuda_porc_pib %>% 
  filter(cobertura == "Gobierno central"  ) %>% 
  select(iso3c, year, externa_p, interna_p, total_p) %>% 
  mutate(ext_2_total_p = externa_p/total_p)

sectorpublico_deuda_pib <- sp_deuda_porc_pib %>% 
  filter(cobertura == "Sector público") %>% 
  select(iso3c, year, externa_p, interna_p, total_p)

gsubnac_deuda_pib <- sp_deuda_porc_pib %>% 
  filter(cobertura == "Gobiernos subnacionales") %>% 
  select(iso3c, year, externa_p, interna_p, total_p)

gspnf_deuda_pib <- sp_deuda_porc_pib %>% 
  filter(cobertura == "Sector público no financiero") %>% 
  select(iso3c, year, externa_p, interna_p, total_p)%>% 
  mutate(ext_2_total_p = externa_p/total_p)

```



### Latin America, Central Goverment {.tabset}


Salient features:

+  En términos generales, el perfil temporal de la deuda total de los Gobiernos Centrales 
es similar al del país en su conjunto, visto en la sección anterior: muestra cuerta covergencia hacia el final de }la muestra, con un alza en mucho pasíses entre 1998 y el 2005, más o menos.

+  Lo que parece más interesante de comentar en esta sección es el alza absoluta y relativa de la deuda doméstica 
de los gobiernos centrales, que se puede apreciar tanto el gráfico que muestra la deuda doméstica del gobierno como porcentaje del pib, como en el cuarto gráfico donde se observa una declinación del componente externo de la deuda de los gobiernos

+ En este último punto, es notorio como en 1990 sólo en un país, Chile, tenía una composición mayoritariamente doméstica del la deuda pública (y probablemente también Brasil, pero no existen datos 
previos a 1998), mientras que en el 2015 ya son 7 los países donde menos de la mitad de la deuda pública es externa.
Sólo Nicaragua y Boliva han incrementado notoriamente la proporción de deuda externa dentro de la deuda del gobierno central en los últimos años.

+ Para el año 2015, la deuda pública externa es un cuarto o menos de la deuda total en Colombia, Costa Rica, Chile y Brasil. 



```{r gobcen_debt_make_dfs_18, include=TRUE}
gobcen_deuda_18 <- gcentral_deuda_pib %>% 
  filter(iso3c %in% coi_18)

gobcen_deuda_tot_18_xts <- cate_gen_to_xts_wide(gobcen_deuda_18 %>% select(iso3c, year, total_p), is_full = TRUE, is_med = FALSE, value_col_name = "total_p")

gobcen_deuda_dom_18_xts <- cate_gen_to_xts_wide(gobcen_deuda_18 %>% select(iso3c, year, interna_p), is_full = TRUE, is_med = FALSE, value_col_name = "interna_p")

gobcen_deuda_ext_18_xts <- cate_gen_to_xts_wide(gobcen_deuda_18 %>% select(iso3c, year, externa_p), is_full = TRUE, is_med = FALSE, value_col_name = "externa_p")

gobcen_deuda_ext_2_tot_18_xts <- gobcen_deuda_ext_18_xts/gobcen_deuda_tot_18_xts


gobcen_deuda_tot_18_class_pct4_1990_2015 <- cate_gen(
  df = gobcen_deuda_18 %>% select(iso3c, year, total_p),
  value_col_name = "total_p", is_med = FALSE,  is_pct4 = TRUE)

gobcen_deuda_dom_18_class_pct4_1990_2015 <- cate_gen(
  df = gobcen_deuda_18 %>% select(iso3c, year, interna_p),
  value_col_name = "interna_p", is_med = FALSE,  is_pct4 = TRUE)

gobcen_deuda_ext_18_class_pct4_1990_2015 <- cate_gen(
  df = gobcen_deuda_18 %>% select(iso3c, year, externa_p),
  value_col_name = "externa_p", is_med = FALSE,  is_pct4 = TRUE)

gobcen_deuda_ext_2_tot_18_class_pct4_1990_2015 <- cate_gen(
  df = gobcen_deuda_18 %>% select(iso3c, year, ext_2_total_p),
  value_col_name = "ext_2_total_p", is_med = FALSE,  is_pct4 = TRUE)


gobcen_deuda_tot_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = gobcen_deuda_18 %>% select(iso3c, year, total_p),
  value_col_name = "total_p", time_breaks = default_time_break, is_med = FALSE,
                                               is_pct4 = TRUE)

gobcen_deuda_dom_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = gobcen_deuda_18 %>% select(iso3c, year, interna_p),
  value_col_name = "interna_p", time_breaks = default_time_break, is_med = FALSE,
                                               is_pct4 = TRUE)

gobcen_deuda_ext_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = gobcen_deuda_18 %>% select(iso3c, year, externa_p),
  value_col_name = "externa_p", time_breaks = default_time_break, is_med = FALSE,
                                               is_pct4 = TRUE)

gobcen_deuda_ext_2_tot_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = gobcen_deuda_18 %>% select(iso3c, year, ext_2_total_p),
  value_col_name = "ext_2_total_p", time_breaks = default_time_break, is_med = FALSE,
                                               is_pct4 = TRUE)


gobcen_deuda_tot_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  gobcen_deuda_tot_18_class_pct4_1990_2015,
  value_col_name = "total_p", is_med = FALSE, is_pct4 = TRUE)

gobcen_deuda_dom_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  gobcen_deuda_dom_18_class_pct4_1990_2015,
  value_col_name = "interna_p", is_med = FALSE, is_pct4 = TRUE)

gobcen_deuda_ext_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  gobcen_deuda_ext_18_class_pct4_1990_2015,
  value_col_name = "externa_p", is_med = FALSE, is_pct4 = TRUE)

gobcen_deuda_ext_2_tot_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  gobcen_deuda_ext_2_tot_18_class_pct4_1990_2015,
  value_col_name = "ext_2_total_p", is_med = FALSE, is_pct4 = TRUE)


gobcen_deuda_tot_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(gobcen_deuda_tot_18_class_pct4_1990_2001_2015[[1]], 
                    value_col_name = "total_p",is_med = FALSE, is_pct4 = TRUE)

gobcen_deuda_tot_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(gobcen_deuda_tot_18_class_pct4_1990_2001_2015[[2]], 
                    value_col_name = "total_p",is_med = FALSE, is_pct4 = TRUE)

gobcen_deuda_dom_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(gobcen_deuda_dom_18_class_pct4_1990_2001_2015[[1]], 
                    value_col_name = "interna_p",is_med = FALSE, is_pct4 = TRUE)

gobcen_deuda_dom_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(gobcen_deuda_dom_18_class_pct4_1990_2001_2015[[2]], 
                    value_col_name = "interna_p",is_med = FALSE, is_pct4 = TRUE)

gobcen_deuda_ext_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(gobcen_deuda_ext_18_class_pct4_1990_2001_2015[[1]], 
                    value_col_name = "externa_p",is_med = FALSE, is_pct4 = TRUE)

gobcen_deuda_ext_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(gobcen_deuda_ext_18_class_pct4_1990_2001_2015[[2]], 
                    value_col_name = "externa_p",is_med = FALSE, is_pct4 = TRUE)


gobcen_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(gobcen_deuda_ext_2_tot_18_class_pct4_1990_2001_2015[[1]], 
                    value_col_name = "ext_2_total_p",is_med = FALSE, is_pct4 = TRUE)

gobcen_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(gobcen_deuda_ext_2_tot_18_class_pct4_1990_2001_2015[[2]], 
                    value_col_name = "ext_2_total_p",is_med = FALSE, is_pct4 = TRUE)

```

#### All  countries
```{r gobcen_debt_make_dygraph_18, eval=params$dygraphs_plots}
#using dygraph
dgcd_tot_title_18 <- "(Gross) Total Central Gov. Debt, as % of GDP"

dgcd_tot_18 <- dygraph(gobcen_deuda_tot_18_xts, main = dgcd_tot_title_18, group = "public") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dgcd_tot_18

dgcd_dom_title_18 <- "(Gross) Domestic Central Gov. Debt, as % of GDP"

dgcd_dom_18 <- dygraph(gobcen_deuda_dom_18_xts, main = dgcd_dom_title_18, group = "public") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dgcd_dom_18

dgcd_ext_title_18 <- "(Gross) External Central Gov. Debt, as % of GDP"

dgcd_ext_18 <- dygraph(gobcen_deuda_ext_18_xts, main = dgcd_ext_title_18, group = "public") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dgcd_ext_18


dgcd_ext_2_tot_title_18 <- "Central Gov. Debt: external as % of total"

dgcd_ext_2_tot_18 <- dygraph(gobcen_deuda_ext_2_tot_18_xts, main = dgcd_ext_2_tot_title_18, group = "public") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dgcd_ext_2_tot_18



```

#### Countries sorted into quartiles of the Y-axis variable  {.tabset}


##### Total 

```{r gobcen_tot_debt_make_dygraph_18_pct4_period2, eval=params$dygraphs_plots}
dgcd_tot_title_18_1 <- "(Gross) Total Central Gov. Debt, Quartile 1 (lowest)"
dgcg_tot_18_pct4_b25_2001_period2 <- dygraph(gobcen_deuda_tot_18_pct4_1990_2001_2015_xts_2[["below_p25"]], main = dgcd_tot_title_18_1, group = "total") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcd_tot_title_18_2 <- "(Gross) Total Central Gov. Debt, Quartile 2"
dgcg_tot_18_pct4_25_to_50_2001_period2 <- dygraph(gobcen_deuda_tot_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]], main = dgcd_tot_title_18_2, group = "total") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcd_tot_title_18_3 <- "(Gross) Total Central Gov. Debt, Quartile 3"
dgcg_tot_18_pct4_50_to_75_2001_period2 <- dygraph(gobcen_deuda_tot_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]], main = dgcd_tot_title_18_3, group = "total") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcd_tot_title_18_4 <- "(Gross) Total Central Gov. Debt, Quartile 4"
dgcg_tot_18_pct4_a75_2001_period2 <- dygraph(gobcen_deuda_tot_18_pct4_1990_2001_2015_xts_2[["above_p75"]], main = dgcd_tot_title_18_4, group = "total") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_tot_18_pct4_a75_2001_period2

dgcg_tot_18_pct4_50_to_75_2001_period2

dgcg_tot_18_pct4_25_to_50_2001_period2

dgcg_tot_18_pct4_b25_2001_period2

```

##### Domestic

```{r gobcen_dom_debt_make_dygraph_18_pct4_period2, eval=params$dygraphs_plots}
dgcd_dom_title_18_1 <- "(Gross) Domestic Central Gov. Debt, Quartile 1 (lowest)"
dgcd_dom_title_18_2 <- "(Gross) Domestic Central Gov. Debt, Quartile 2 "
dgcd_dom_title_18_3 <- "(Gross) Domestic Central Gov. Debt, Quartile 3 "
dgcd_dom_title_18_4 <- "(Gross) Domestic Central Gov. Debt, Quartile 4 (highest)"

dgcg_dom_18_pct4_b25_2001_period2 <- dygraph(gobcen_deuda_dom_18_pct4_1990_2001_2015_xts_2[["below_p25"]], main = dgcd_dom_title_18_1, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_dom_18_pct4_25_to_50_2001_period2 <- dygraph(gobcen_deuda_dom_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]], main = dgcd_dom_title_18_2, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_dom_18_pct4_50_to_75_2001_period2 <- dygraph(gobcen_deuda_dom_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]], main = dgcd_dom_title_18_3, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_dom_18_pct4_a75_2001_period2 <- dygraph(gobcen_deuda_dom_18_pct4_1990_2001_2015_xts_2[["above_p75"]], main = dgcd_dom_title_18_4, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_dom_18_pct4_a75_2001_period2

dgcg_dom_18_pct4_50_to_75_2001_period2

dgcg_dom_18_pct4_25_to_50_2001_period2

dgcg_dom_18_pct4_b25_2001_period2



```


##### External

```{r gobcen_ext_debt_make_dygraph_18_pct4_period2, eval=params$dygraphs_plots}
dgcd_ext_title_18_1 <- "(Gross) External Central Gov. Debt, Quartile 1 (lowest)"
dgcd_ext_title_18_2 <- "(Gross) External Central Gov. Debt, Quartile 2 "
dgcd_ext_title_18_3 <- "(Gross) External Central Gov. Debt, Quartile 3 "
dgcd_ext_title_18_4 <- "(Gross) External Central Gov. Debt, Quartile 4 (highest)"

dgcg_ext_18_pct4_b25_2001_period2 <- dygraph(gobcen_deuda_ext_18_pct4_1990_2001_2015_xts_2[["below_p25"]], main = dgcd_ext_title_18_1, group = "external") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_ext_18_pct4_25_to_50_2001_period2 <- dygraph(gobcen_deuda_ext_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]], main = dgcd_ext_title_18_2, group = "external") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_ext_18_pct4_50_to_75_2001_period2 <- dygraph(gobcen_deuda_ext_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]], main = dgcd_ext_title_18_3, group = "external") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_ext_18_pct4_a75_2001_period2 <- dygraph(gobcen_deuda_ext_18_pct4_1990_2001_2015_xts_2[["above_p75"]], main = dgcd_ext_title_18_4, group = "external") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_ext_18_pct4_a75_2001_period2

dgcg_ext_18_pct4_50_to_75_2001_period2

dgcg_ext_18_pct4_25_to_50_2001_period2

dgcg_ext_18_pct4_b25_2001_period2


```

##### External/Total


```{r gobcen_ext_2_tot_debt_make_dygraph_18_pct4_period2, eval=params$dygraphs_plots}

dgcd_ext_2_tot_title_18_1 <- "Central Gov.,External as % of Total, Quartile 1 (lowest)"
dgcd_ext_2_tot_title_18_2 <- "Central Gov.,External as % of Total, Quartile 2 "
dgcd_ext_2_tot_title_18_3 <- "Central Gov.,External as % of Total, Quartile 3 "
dgcd_ext_2_tot_title_18_4 <- "Central Gov.,External as % of Total, Quartile 4 (highest)"


dgcg_ext_2_tot_18_pct4_b25_2001_period2 <- dygraph(gobcen_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_2[["below_p25"]], main = dgcd_ext_2_tot_title_18_1, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_ext_2_tot_18_pct4_25_to_50_2001_period2 <- dygraph(gobcen_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]], main = dgcd_ext_2_tot_title_18_2, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_ext_2_tot_18_pct4_50_to_75_2001_period2 <- dygraph(gobcen_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]], main = dgcd_ext_2_tot_title_18_3, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_ext_2_tot_18_pct4_a75_2001_period2 <- dygraph(gobcen_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_2[["above_p75"]], main = dgcd_ext_2_tot_title_18_4, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgcg_ext_2_tot_18_pct4_a75_2001_period2

dgcg_ext_2_tot_18_pct4_50_to_75_2001_period2

dgcg_ext_2_tot_18_pct4_25_to_50_2001_period2

dgcg_ext_2_tot_18_pct4_b25_2001_period2

```










### Latin America, Non Financial Public Sector {.tabset}


Salient features:

+  


```{r spnf_debt_make_dfs_18, include=TRUE}
spnf_deuda_18 <- gspnf_deuda_pib %>% 
  filter(iso3c %in% coi_18)

spnf_deuda_tot_18_xts <- cate_gen_to_xts_wide(spnf_deuda_18 %>% select(iso3c, year, total_p), is_full = TRUE, is_med = FALSE, value_col_name = "total_p")

spnf_deuda_dom_18_xts <- cate_gen_to_xts_wide(spnf_deuda_18 %>% select(iso3c, year, interna_p), is_full = TRUE, is_med = FALSE, value_col_name = "interna_p")

spnf_deuda_ext_18_xts <- cate_gen_to_xts_wide(spnf_deuda_18 %>% select(iso3c, year, externa_p), is_full = TRUE, is_med = FALSE, value_col_name = "externa_p")

spnf_deuda_ext_2_tot_18_xts <- cate_gen_to_xts_wide(spnf_deuda_18 %>% select(iso3c, year, ext_2_total_p), is_full = TRUE, is_med = FALSE, value_col_name = "ext_2_total_p")


spnf_deuda_tot_18_class_pct4_1990_2015 <- cate_gen(
  df = spnf_deuda_18 %>% select(iso3c, year, total_p),
  value_col_name = "total_p", is_med = FALSE,  is_pct4 = TRUE)

spnf_deuda_dom_18_class_pct4_1990_2015 <- cate_gen(
  df = spnf_deuda_18 %>% select(iso3c, year, interna_p),
  value_col_name = "interna_p", is_med = FALSE,  is_pct4 = TRUE)

spnf_deuda_ext_18_class_pct4_1990_2015 <- cate_gen(
  df = spnf_deuda_18 %>% select(iso3c, year, externa_p),
  value_col_name = "externa_p", is_med = FALSE,  is_pct4 = TRUE)

spnf_deuda_ext_2_tot_18_class_pct4_1990_2015 <- cate_gen(
  df = spnf_deuda_18 %>% select(iso3c, year, ext_2_total_p),
  value_col_name = "ext_2_total_p", is_med = FALSE,  is_pct4 = TRUE)


spnf_deuda_tot_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = spnf_deuda_18 %>% select(iso3c, year, total_p),
  value_col_name = "total_p", time_breaks = default_time_break, is_med = FALSE,
                                               is_pct4 = TRUE)

spnf_deuda_dom_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = spnf_deuda_18 %>% select(iso3c, year, interna_p),
  value_col_name = "interna_p", time_breaks = default_time_break, is_med = FALSE,
                                               is_pct4 = TRUE)

spnf_deuda_ext_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = spnf_deuda_18 %>% select(iso3c, year, externa_p),
  value_col_name = "externa_p", time_breaks = default_time_break, is_med = FALSE,
                                               is_pct4 = TRUE)

spnf_deuda_ext_2_tot_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = spnf_deuda_18 %>% select(iso3c, year, ext_2_total_p),
  value_col_name = "ext_2_total_p", time_breaks = default_time_break, is_med = FALSE,
                                               is_pct4 = TRUE)


spnf_deuda_tot_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  spnf_deuda_tot_18_class_pct4_1990_2015,
  value_col_name = "total_p", is_med = FALSE, is_pct4 = TRUE)

spnf_deuda_dom_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  spnf_deuda_dom_18_class_pct4_1990_2015,
  value_col_name = "interna_p", is_med = FALSE, is_pct4 = TRUE)

spnf_deuda_ext_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  spnf_deuda_ext_18_class_pct4_1990_2015,
  value_col_name = "externa_p", is_med = FALSE, is_pct4 = TRUE)

spnf_deuda_ext_2_tot_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  spnf_deuda_ext_2_tot_18_class_pct4_1990_2015,
  value_col_name = "ext_2_total_p", is_med = FALSE, is_pct4 = TRUE)


spnf_deuda_tot_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(spnf_deuda_tot_18_class_pct4_1990_2001_2015[[1]], 
                    value_col_name = "total_p",is_med = FALSE, is_pct4 = TRUE)

spnf_deuda_tot_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(spnf_deuda_tot_18_class_pct4_1990_2001_2015[[2]], 
                    value_col_name = "total_p",is_med = FALSE, is_pct4 = TRUE)

spnf_deuda_dom_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(spnf_deuda_dom_18_class_pct4_1990_2001_2015[[1]], 
                    value_col_name = "interna_p",is_med = FALSE, is_pct4 = TRUE)

spnf_deuda_dom_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(spnf_deuda_dom_18_class_pct4_1990_2001_2015[[2]], 
                    value_col_name = "interna_p",is_med = FALSE, is_pct4 = TRUE)

spnf_deuda_ext_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(spnf_deuda_ext_18_class_pct4_1990_2001_2015[[1]], 
                    value_col_name = "externa_p",is_med = FALSE, is_pct4 = TRUE)

spnf_deuda_ext_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(spnf_deuda_ext_18_class_pct4_1990_2001_2015[[2]], 
                    value_col_name = "externa_p",is_med = FALSE, is_pct4 = TRUE)


spnf_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(spnf_deuda_ext_2_tot_18_class_pct4_1990_2001_2015[[1]], 
                    value_col_name = "ext_2_total_p",is_med = FALSE, is_pct4 = TRUE)

spnf_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(spnf_deuda_ext_2_tot_18_class_pct4_1990_2001_2015[[2]], 
                    value_col_name = "ext_2_total_p",is_med = FALSE, is_pct4 = TRUE)

```

#### All  countries
```{r spnf_debt_make_dygraph_18, eval=params$dygraphs_plots}
#using dygraph
dgspnf_tot_title_18 <- "(Gross) Total NFSP Debt, as % of GDP"

dgspnf_tot_18 <- dygraph(spnf_deuda_tot_18_xts, main = dgspnf_tot_title_18, group = "public") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dgspnf_tot_18

dgspnf_dom_title_18 <- "(Gross) Domestic NFSP Debt, as % of GDP"

dgspnf_dom_18 <- dygraph(spnf_deuda_dom_18_xts, main = dgspnf_dom_title_18, group = "public") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dgspnf_dom_18

dgspnf_ext_title_18 <- "(Gross) External NFSP Debt, as % of GDP"

dgspnf_ext_18 <- dygraph(spnf_deuda_ext_18_xts, main = dgspnf_ext_title_18, group = "public") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dgspnf_ext_18


dgspnf_ext_2_tot_title_18 <- "NFSP Debt: external as % of total"

dgspnf_ext_2_tot_18 <- dygraph(spnf_deuda_ext_2_tot_18_xts, main = dgspnf_ext_2_tot_title_18, group = "public") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dgspnf_ext_2_tot_18



```

#### Countries sorted into quartiles of the Y-axis variable  {.tabset}


##### Total 

```{r spnf_tot_debt_make_dygraph_18_pct4_period2, eval=params$dygraphs_plots}
dgspnf_tot_title_18_1 <- "(Gross) Total NFSP Debt, Quartile 1 (lowest)"
dgspnf_tot_18_pct4_b25_2001_period2 <- dygraph(spnf_deuda_tot_18_pct4_1990_2001_2015_xts_2[["below_p25"]], main = dgspnf_tot_title_18_1, group = "total") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_tot_title_18_2 <- "(Gross) Total NFSP Debt, Quartile 2"
dgspnf_tot_18_pct4_25_to_50_2001_period2 <- dygraph(spnf_deuda_tot_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]], main = dgspnf_tot_title_18_2, group = "total") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_tot_title_18_3 <- "(Gross) Total NFSP Debt, Quartile 3"
dgspnf_tot_18_pct4_50_to_75_2001_period2 <- dygraph(spnf_deuda_tot_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]], main = dgspnf_tot_title_18_3, group = "total") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_tot_title_18_4 <- "(Gross) Total NFSP Debt, Quartile 4"
dgspnf_tot_18_pct4_a75_2001_period2 <- dygraph(spnf_deuda_tot_18_pct4_1990_2001_2015_xts_2[["above_p75"]], main = dgspnf_tot_title_18_4, group = "total") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_tot_18_pct4_a75_2001_period2

dgspnf_tot_18_pct4_50_to_75_2001_period2

dgspnf_tot_18_pct4_25_to_50_2001_period2

dgspnf_tot_18_pct4_b25_2001_period2

```

##### Domestic

```{r spnf_dom_debt_make_dygraph_18_pct4_period2, eval=params$dygraphs_plots}
dgspnf_dom_title_18_1 <- "(Gross) Domestic NFSP Debt, Quartile 1 (lowest)"
dgspnf_dom_title_18_2 <- "(Gross) Domestic NFSP Debt, Quartile 2 "
dgspnf_dom_title_18_3 <- "(Gross) Domestic NFSP Debt, Quartile 3 "
dgspnf_dom_title_18_4 <- "(Gross) Domestic NFSP Debt, Quartile 4 (highest)"

dgspnf_dom_18_pct4_b25_2001_period2 <- dygraph(spnf_deuda_dom_18_pct4_1990_2001_2015_xts_2[["below_p25"]], main = dgspnf_dom_title_18_1, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_dom_18_pct4_25_to_50_2001_period2 <- dygraph(spnf_deuda_dom_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]], main = dgspnf_dom_title_18_2, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_dom_18_pct4_50_to_75_2001_period2 <- dygraph(spnf_deuda_dom_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]], main = dgspnf_dom_title_18_3, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_dom_18_pct4_a75_2001_period2 <- dygraph(spnf_deuda_dom_18_pct4_1990_2001_2015_xts_2[["above_p75"]], main = dgspnf_dom_title_18_4, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_dom_18_pct4_a75_2001_period2

dgspnf_dom_18_pct4_50_to_75_2001_period2

dgspnf_dom_18_pct4_25_to_50_2001_period2

dgspnf_dom_18_pct4_b25_2001_period2



```


##### External

```{r spnf_ext_debt_make_dygraph_18_pct4_period2, eval=params$dygraphs_plots}
dgspnf_ext_title_18_1 <- "(Gross) External NFSP Debt, Quartile 1 (lowest)"
dgspnf_ext_title_18_2 <- "(Gross) External NFSP Debt, Quartile 2 "
dgspnf_ext_title_18_3 <- "(Gross) External NFSP Debt, Quartile 3 "
dgspnf_ext_title_18_4 <- "(Gross) External NFSP Debt, Quartile 4 (highest)"

dgspnf_ext_18_pct4_b25_2001_period2 <- dygraph(spnf_deuda_ext_18_pct4_1990_2001_2015_xts_2[["below_p25"]], main = dgspnf_ext_title_18_1, group = "external") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_ext_18_pct4_25_to_50_2001_period2 <- dygraph(spnf_deuda_ext_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]], main = dgspnf_ext_title_18_2, group = "external") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_ext_18_pct4_50_to_75_2001_period2 <- dygraph(spnf_deuda_ext_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]], main = dgspnf_ext_title_18_3, group = "external") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_ext_18_pct4_a75_2001_period2 <- dygraph(spnf_deuda_ext_18_pct4_1990_2001_2015_xts_2[["above_p75"]], main = dgspnf_ext_title_18_4, group = "external") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_ext_18_pct4_a75_2001_period2

dgspnf_ext_18_pct4_50_to_75_2001_period2

dgspnf_ext_18_pct4_25_to_50_2001_period2

dgspnf_ext_18_pct4_b25_2001_period2


```

##### External/Total


```{r spnf_ext_2_tot_debt_make_dygraph_18_pct4_period2, eval=params$dygraphs_plots}

dgspnf_ext_2_tot_title_18_1 <- "NFSP: External as % of Total, Quartile 1 (lowest)"
dgspnf_ext_2_tot_title_18_2 <- "NFSP: External as % of Total, Quartile 2 "
dgspnf_ext_2_tot_title_18_3 <- "NFSP: External as % of Total, Quartile 3 "
dgspnf_ext_2_tot_title_18_4 <- "NFSP: External as % of Total, Quartile 4 (highest)"

dgspnf_ext_2_tot_18_pct4_b25_2001_period2 <- dygraph(spnf_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_2[["below_p25"]], main = dgspnf_ext_2_tot_title_18_1, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_ext_2_tot_18_pct4_25_to_50_2001_period2 <- dygraph(spnf_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]], main = dgspnf_ext_2_tot_title_18_2, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_ext_2_tot_18_pct4_50_to_75_2001_period2 <- dygraph(spnf_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]], main = dgspnf_ext_2_tot_title_18_3, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_ext_2_tot_18_pct4_a75_2001_period2 <- dygraph(spnf_deuda_ext_2_tot_18_pct4_1990_2001_2015_xts_2[["above_p75"]], main = dgspnf_ext_2_tot_title_18_4, group = "domestic") %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dgspnf_ext_2_tot_18_pct4_a75_2001_period2

dgspnf_ext_2_tot_18_pct4_50_to_75_2001_period2

dgspnf_ext_2_tot_18_pct4_25_to_50_2001_period2

dgspnf_ext_2_tot_18_pct4_b25_2001_period2

```







## Cartera vencida 

```{r cartera_vencida_make}

cv_december <- cartera_vencida_33_tidy %>% 
  filter(iso3c %in% coi) %>% 
  filter( month == 12 ) %>% 
    mutate(year = as.Date(as.character(year), format = "%Y"))


cv_3_6_9_12 <- cartera_vencida_33_tidy %>% 
  filter(iso3c %in% coi) %>% 
  filter( month  %in%  c(3,6,9,12))

cartera_vencida_qtr_with_gdp <- cs_gdp_currentlc_q_gasto %>%
  select(-c(iso3c, nombre_pais, Rubro)) %>%
  left_join( cartera_vencida_33_tidy ,  by = c("iso2c", "date")) %>%
  filter( !is.na(cartera_vencida_percent) ) %>% 
  filter(iso3c %in% coi)

mr_3_cv_anual <- cv_december %>%
  filter(!is.na(cartera_vencida_percent)) %>% 
  group_by(iso3c) %>% 
  arrange(year) %>% 
  summarise(year_mr = max(year),
            cv_mr = last(cartera_vencida_percent),
            avg_mr_3 = mean(tail(cartera_vencida_percent, 3) , rm.na = TRUE)
  ) %>% 
  arrange(desc(cv_mr)) %>% 
  mutate(rnk_mr_cv = min_rank(-cv_mr),
         rnk_mr_3_cv = min_rank(-avg_mr_3)) %>% 
  arrange(iso3c)

```

### Latin America {.tabset}


```{r cv_make_dfs_18, include=TRUE}
cv_18 <- cv_december %>% 
  filter(iso3c %in% coi_18)

cv_18_xts <- cate_gen_to_xts_wide(cv_18 %>% select(iso3c, year, cartera_vencida_percent)    , value_col_name = "cartera_vencida_percent",  is_full = TRUE, is_med = FALSE)

cv_18_class_pct4_1990_2001_2015 <- cate_gen(cv_18 %>% 
    select(iso3c, year, cartera_vencida_percent), value_col_name = "cartera_vencida_percent", time_breaks = default_time_break, is_med = FALSE, is_pct3 = FALSE,
                                               is_pct4 = TRUE)

# cv_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(cv_18_class_pct4_1990_2001_2015[[1]] %>% filter(!is.na(gen_group)), 
#     value_col_name = "cartera_vencida_percent", is_med = FALSE, is_pct4 = TRUE)

cv_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(cv_18_class_pct4_1990_2001_2015[[2]], 
    value_col_name = "cartera_vencida_percent", is_med = FALSE, is_pct4 = TRUE)

```

#### All (18) countries
```{r cv_make_dygraph_18}
#using dygraph
dcv_title_18 <- "Cartera Vencida,  % de cartera (E18)"

dcv_18 <- dygraph(cv_18_xts, main = dcv_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dcv_18
```

#### Countries sorted into quartiles of the Y-axis variable


```{r cv_make_dygraph_18_2001_pct25_50_75_period2}
dcv_18_pct4_b25_2001_period2 <- dygraph(
  cv_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dcv_18_pct4_25_to_50_2001_period2 <- dygraph(cv_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dcv_18_pct4_50_to_75_2001_period2 <- dygraph(cv_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dcv_18_pct4_a75_2001_period2 <- dygraph(cv_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dcv_18_pct4_a75_2001_period2

dcv_18_pct4_50_to_75_2001_period2

dcv_18_pct4_25_to_50_2001_period2

dcv_18_pct4_b25_2001_period2

```

## Crédito interno

```{r credito_interno_make_dfs}

credito_interno_qtr <- cs_gdp_currentlc_q_gasto %>% 
  select(-iso3c, -nombre_pais, -Rubro, -year) %>% 
  left_join( credito_interno_33_tidy ,  by = c("iso2c", "date")) %>% 
  filter( !is.na(total) ) %>% 
  mutate(total_to_gdp_seas = total/gdp_sa_seas,
         al_spub_gdp_seas = al.sector.publico/gdp_sa_seas,
         al_spriv_gdp_seas = al.sector.privado/gdp_sa_seas,
         al_gob_gdp_seas = gobierno/gdp_sa_seas,
         a_otros_gdp_seas = otros/gdp_sa_seas,
         total_to_gdp_stl = total/gdp_sa_stl,
         al_spub_gdp_stl = al.sector.publico/gdp_sa_stl,
         al_spriv_gdp_stl = al.sector.privado/gdp_sa_stl,
         al_gob_gdp_stl = gobierno/gdp_sa_stl,
         a_otros_gdp_stl = otros/gdp_sa_stl) %>% 
  dplyr::select(- ends_with("_stl")) %>% 
  select(- dplyr::contains("al.")) %>% 
  select(- c(otros, otros.1, gdp,  total, gobierno, month))


tab_ci_qrt_gdp <- credito_interno_qtr %>% 
  group_by(iso2c, year) %>%
  summarise(nobs = n(), 
            num_countries = length(unique(credito_interno_qtr$iso2c)),
            avg_spu_gdp = mean(al_spub_gdp_seas, rm.na = TRUE),
            avg_spr_gdp = mean(al_spriv_gdp_seas, rm.na = TRUE),
            avg_tot_gdp = mean(total_to_gdp_seas, rm.na = TRUE),
            avg_gob_gdp = mean(al_gob_gdp_seas, rm.na = TRUE),
            n_gob_gdp = sum(!is.na(al_gob_gdp_seas)),
            n_tot_gdp = sum(!is.na(total_to_gdp_seas)),
            n_spub_gdp = sum(!is.na(al_spub_gdp_seas)),
            n_spr_gdp = sum(!is.na(al_spriv_gdp_seas))
  )


mr_3_ci_to_gdp <- tab_ci_qrt_gdp %>% 
  group_by(iso2c) %>% 
  arrange(year) %>% 
  summarise(year_mr = max(year),
            ci_total_mr = last(avg_tot_gdp),
            avg_mr_ci_tot_3 = mean(tail(avg_tot_gdp, 3) , rm.na = TRUE),
            ci_spu_mr = last(avg_spu_gdp),
            avg_mr_ci_spu_3 = mean(tail(avg_spu_gdp, 3) , rm.na = TRUE),
            ci_spr_mr = last(avg_spr_gdp),
            avg_mr_ci_spr_3 = mean(tail(avg_spr_gdp, 3) , rm.na = TRUE)
  ) %>% 
  arrange(desc(ci_total_mr)) %>% 
  mutate(rnk_mr_tot = min_rank(-ci_total_mr),
         rnk_mr_3_tot = min_rank(-avg_mr_ci_tot_3)) %>% 
  arrange(iso2c)

```


### Latin America {.tabset}


```{r ci_make_dfs_18, include=TRUE}

ci_time_break <- as.Date("2004-10-01", format = "%Y-%m-%d") # 4th quarter of 2004

ci_18 <- credito_interno_qtr %>% 
  filter(iso3c %in% coi_18) %>% 
  filter( iso3c != "COL") # remove colombia until fix in ci or gdp data (ratio is off by 3 orders of magnitude)

ci_tot_18_xts <- cate_gen_to_xts_wide(ci_18 %>% select(iso3c, date, total_to_gdp_seas), is_full = TRUE, is_med = FALSE, value_col_name = "total_to_gdp_seas", dating_col_name = "date")

ci_spu_18_xts <- cate_gen_to_xts_wide(ci_18 %>% select(iso3c, date, al_spub_gdp_seas), is_full = TRUE, is_med = FALSE, value_col_name = "al_spub_gdp_seas", dating_col_name = "date")

ci_spri_18_xts <- cate_gen_to_xts_wide(ci_18 %>% select(iso3c, date, al_spriv_gdp_seas), is_full = TRUE, is_med = FALSE, value_col_name = "al_spriv_gdp_seas", dating_col_name = "date")


ci_tot_18_class_pct4_1990_2015 <- cate_gen(
  df = ci_18 %>% select(iso3c, date, total_to_gdp_seas),
  value_col_name = "total_to_gdp_seas", is_med = FALSE,  is_pct4 = TRUE)

ci_spu_18_class_pct4_1990_2015 <- cate_gen(
  df = ci_18 %>% select(iso3c, date, al_spub_gdp_seas),
  value_col_name = "al_spub_gdp_seas", is_med = FALSE,  is_pct4 = TRUE)

ci_spri_18_class_pct4_1990_2015 <- cate_gen(
  df = ci_18 %>% select(iso3c, date, al_spriv_gdp_seas),
  value_col_name = "al_spriv_gdp_seas", is_med = FALSE,  is_pct4 = TRUE)



ci_tot_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = ci_18 %>% select(iso3c, date, total_to_gdp_seas),
  value_col_name = "total_to_gdp_seas", time_breaks = ci_time_break, is_med = FALSE,
                 is_pct4 = TRUE, dating_col_name = "date")

ci_spu_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = ci_18 %>% select(iso3c, date, al_spub_gdp_seas),
  value_col_name = "al_spub_gdp_seas", time_breaks = ci_time_break, is_med = FALSE,
                     is_pct4 = TRUE, dating_col_name = "date")

ci_spri_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = ci_18 %>% select(iso3c, date, al_spriv_gdp_seas),
  value_col_name = "al_spriv_gdp_seas", time_breaks = ci_time_break, is_med = FALSE,
                    is_pct4 = TRUE, dating_col_name = "date")


ci_tot_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  ci_tot_18_class_pct4_1990_2015,
  value_col_name = "total_to_gdp_seas",
  dating_col_name = "date", is_med = FALSE, is_pct4 = TRUE)

ci_spu_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  ci_spu_18_class_pct4_1990_2015,
  value_col_name = "al_spub_gdp_seas", 
  dating_col_name = "date", is_med = FALSE, is_pct4 = TRUE)

ci_spri_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  ci_spri_18_class_pct4_1990_2015,
  value_col_name = "al_spriv_gdp_seas", dating_col_name = "date",
  is_med = FALSE, is_pct4 = TRUE)


ci_tot_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(
  ci_tot_18_class_pct4_1990_2001_2015[[1]], dating_col_name = "date",
  value_col_name = "total_to_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

ci_tot_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(
  ci_tot_18_class_pct4_1990_2001_2015[[2]], dating_col_name = "date",
                    value_col_name = "total_to_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

ci_spu_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(
  ci_spu_18_class_pct4_1990_2001_2015[[1]], dating_col_name = "date", 
                    value_col_name = "al_spub_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

ci_spu_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(
  ci_spu_18_class_pct4_1990_2001_2015[[2]],  dating_col_name = "date",
                    value_col_name = "al_spub_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

ci_spri_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(
  ci_spri_18_class_pct4_1990_2001_2015[[1]],  dating_col_name = "date",
                    value_col_name = "al_spriv_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

ci_spri_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(
  ci_spri_18_class_pct4_1990_2001_2015[[2]],  dating_col_name = "date", 
                    value_col_name = "al_spriv_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

```

#### All (18) countries
```{r ci_make_dygraph_18}
#using dygraph
ci_tot_title_18 <- "Domestic credit, as % of GDP"

ci_tot_18 <- dygraph(ci_tot_18_xts, main = ci_tot_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
ci_tot_18

ci_spu_title_18 <- "Domestic credit to public sector, as % of GDP"

ci_spu_18 <- dygraph(ci_spu_18_xts, main = ci_spu_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
ci_spu_18

ci_spri_title_18 <- "Domestic credit to private sector, as % of GDP"

ci_spri_18 <- dygraph(ci_spri_18_xts, main = ci_spri_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
ci_spri_18

```


#### Countries sorted into quartiles of the Y-axis variable


```{r ci_make_dygraph_18_2001_pct25_50_75_period2}
dci_tot_18_pct4_b25_2001_period2 <- dygraph(ci_tot_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_tot_18_pct4_25_to_50_2001_period2 <- dygraph(ci_tot_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_tot_18_pct4_50_to_75_2001_period2 <- dygraph(ci_tot_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_tot_18_pct4_a75_2001_period2 <- dygraph(ci_tot_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_tot_18_pct4_a75_2001_period2

dci_tot_18_pct4_50_to_75_2001_period2

dci_tot_18_pct4_25_to_50_2001_period2

dci_tot_18_pct4_b25_2001_period2


dci_spu_18_pct4_b25_2001_period2 <- dygraph(ci_spu_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_spu_18_pct4_25_to_50_2001_period2 <- dygraph(ci_spu_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_spu_18_pct4_50_to_75_2001_period2 <- dygraph(ci_spu_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_spu_18_pct4_a75_2001_period2 <- dygraph(ci_spu_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_spu_18_pct4_a75_2001_period2

dci_spu_18_pct4_50_to_75_2001_period2

dci_spu_18_pct4_25_to_50_2001_period2

dci_spu_18_pct4_b25_2001_period2

dci_spri_18_pct4_b25_2001_period2 <- dygraph(ci_spri_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_spri_18_pct4_25_to_50_2001_period2 <- dygraph(ci_spri_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_spri_18_pct4_50_to_75_2001_period2 <- dygraph(ci_spri_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_spri_18_pct4_a75_2001_period2 <- dygraph(ci_spri_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dci_spri_18_pct4_a75_2001_period2

dci_spri_18_pct4_50_to_75_2001_period2

dci_spri_18_pct4_25_to_50_2001_period2

dci_spri_18_pct4_b25_2001_period2

```


## Préstamos Bancarios

```{r prestamos_bancarios_make_dfs}

prestamos_bancarios_qtr <- cs_gdp_currentlc_q_gasto %>% 
    select(-c(iso3c, nombre_pais, Rubro, year)) %>% 
    left_join(prestamos_bancarios_33_tidy,  by = c("iso2c", "date")) %>% 
    filter( !is.na(total) ) %>% 
    mutate(total_to_gdp_seas = total/gdp_sa_seas,
           consumo_gdp_seas = consumo/gdp_sa_seas,
           hipotecario_gdp_seas = hipotecario/gdp_sa_seas,
           industrial_gdp_seas = industrial/gdp_sa_seas,
           comercial_gdp_seas = comercial/gdp_sa_seas)



tab_pb_qtr <- prestamos_bancarios_qtr %>% group_by(iso2c, year) %>% 
  group_by(iso2c, year) %>%
  filter(iso2c != "CO") %>% 
  summarise(nobs = n(), 
            num_countries = length(unique(prestamos_bancarios_qtr$iso2c)),
            avg_tot_to_gdp = mean(total_to_gdp_seas),
            avg_hip_to_gdp = mean(hipotecario_gdp_seas, rm.na=TRUE),
            avg_con_to_gdp = mean(consumo_gdp_seas, rm.na=TRUE),
            n_hip_to_gdp = sum(!is.na(hipotecario_gdp_seas)),
            n_con_to_gdp = sum(!is.na(consumo_gdp_seas))
  )

```


### Latin America {.tabset}


```{r pb_make_dfs_18, include=TRUE}

pb_time_break <- as.Date("2004-10-01", format = "%Y-%m-%d") # 4th quarter of 2004

pb_18 <- prestamos_bancarios_qtr %>% 
  filter(iso3c %in% coi_18) %>% 
  filter( iso3c != "COL") # remove colombia until fix in ci or gdp data (ratio is off by 3 orders of magnitude)

pb_tot_18_xts <- cate_gen_to_xts_wide(pb_18 %>% select(iso3c, date, total_to_gdp_seas), is_full = TRUE, is_med = FALSE, value_col_name = "total_to_gdp_seas", dating_col_name = "date")

pb_hip_18_xts <- cate_gen_to_xts_wide(pb_18 %>% select(iso3c, date, hipotecario_gdp_seas), is_full = TRUE, is_med = FALSE, value_col_name = "hipotecario_gdp_seas", dating_col_name = "date")

pb_con_18_xts <- cate_gen_to_xts_wide(pb_18 %>% select(iso3c, date, consumo_gdp_seas), is_full = TRUE, is_med = FALSE, value_col_name = "consumo_gdp_seas", dating_col_name = "date")


pb_tot_18_class_pct4_1990_2015 <- cate_gen(
  df = pb_18 %>% select(iso3c, date, total_to_gdp_seas),
  value_col_name = "total_to_gdp_seas", is_med = FALSE,  is_pct4 = TRUE)

pb_hip_18_class_pct4_1990_2015 <- cate_gen(
  df = pb_18 %>% select(iso3c, date, hipotecario_gdp_seas),
  value_col_name = "hipotecario_gdp_seas", is_med = FALSE,  is_pct4 = TRUE)

pb_con_18_class_pct4_1990_2015 <- cate_gen(
  df = pb_18 %>% select(iso3c, date, consumo_gdp_seas),
  value_col_name = "consumo_gdp_seas", is_med = FALSE,  is_pct4 = TRUE)



pb_tot_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = pb_18 %>% select(iso3c, date, total_to_gdp_seas),
  value_col_name = "total_to_gdp_seas", time_breaks = pb_time_break, is_med = FALSE,
                 is_pct4 = TRUE, dating_col_name = "date")

pb_hip_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = pb_18 %>% select(iso3c, date, hipotecario_gdp_seas),
  value_col_name = "hipotecario_gdp_seas", time_breaks = pb_time_break, is_med = FALSE,
                     is_pct4 = TRUE, dating_col_name = "date")

pb_con_18_class_pct4_1990_2001_2015 <- cate_gen(
  df = pb_18 %>% select(iso3c, date, consumo_gdp_seas),
  value_col_name = "consumo_gdp_seas", time_breaks = pb_time_break, is_med = FALSE,
                    is_pct4 = TRUE, dating_col_name = "date")


pb_tot_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  pb_tot_18_class_pct4_1990_2015,
  value_col_name = "total_to_gdp_seas",
  dating_col_name = "date", is_med = FALSE, is_pct4 = TRUE)

pb_hip_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  pb_hip_18_class_pct4_1990_2015,
  value_col_name = "hipotecario_gdp_seas", 
  dating_col_name = "date", is_med = FALSE, is_pct4 = TRUE)

pb_con_18_pct4_1990_2015_xts <- cate_gen_to_xts_wide(
  pb_con_18_class_pct4_1990_2015,
  value_col_name = "consumo_gdp_seas", dating_col_name = "date",
  is_med = FALSE, is_pct4 = TRUE)


pb_tot_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(
  pb_tot_18_class_pct4_1990_2001_2015[[1]], dating_col_name = "date",
  value_col_name = "total_to_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

pb_tot_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(
  pb_tot_18_class_pct4_1990_2001_2015[[2]], dating_col_name = "date",
                    value_col_name = "total_to_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

pb_hip_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(
  pb_hip_18_class_pct4_1990_2001_2015[[1]], dating_col_name = "date", 
                    value_col_name = "hipotecario_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

pb_hip_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(
  pb_hip_18_class_pct4_1990_2001_2015[[2]],  dating_col_name = "date",
                    value_col_name = "hipotecario_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

pb_con_18_pct4_1990_2001_2015_xts_1 <- cate_gen_to_xts_wide(
  pb_con_18_class_pct4_1990_2001_2015[[1]],  dating_col_name = "date",
                    value_col_name = "consumo_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

pb_con_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(
  pb_con_18_class_pct4_1990_2001_2015[[2]],  dating_col_name = "date", 
                    value_col_name = "consumo_gdp_seas",is_med = FALSE, is_pct4 = TRUE)

```

#### All (18) countries together
```{r pb_make_dygraph_18}
#using dygraph
pb_tot_title_18 <- "Domestic credit, as % of GDP"

pb_tot_18 <- dygraph(pb_tot_18_xts, main = pb_tot_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
pb_tot_18

pb_hip_title_18 <- "Domestic credit to public sector, as % of GDP"

pb_hip_18 <- dygraph(pb_hip_18_xts, main = pb_hip_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
pb_hip_18

pb_con_title_18 <- "Domestic credit to private sector, as % of GDP"

pb_con_18 <- dygraph(pb_con_18_xts, main = pb_con_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
pb_con_18

```


#### Countries sorted into quartiles of the Y-axis variable

```{r pb_make_dygraph_18_2001_pct25_50_75_period2}
dpb_tot_18_pct4_b25_2001_period2 <- dygraph(pb_tot_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_tot_18_pct4_25_to_50_2001_period2 <- dygraph(pb_tot_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_tot_18_pct4_50_to_75_2001_period2 <- dygraph(pb_tot_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_tot_18_pct4_a75_2001_period2 <- dygraph(pb_tot_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_tot_18_pct4_a75_2001_period2

dpb_tot_18_pct4_50_to_75_2001_period2

dpb_tot_18_pct4_25_to_50_2001_period2

dpb_tot_18_pct4_b25_2001_period2


dpb_hip_18_pct4_b25_2001_period2 <- dygraph(pb_hip_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_hip_18_pct4_25_to_50_2001_period2 <- dygraph(pb_hip_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_hip_18_pct4_50_to_75_2001_period2 <- dygraph(pb_hip_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_hip_18_pct4_a75_2001_period2 <- dygraph(pb_hip_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_hip_18_pct4_a75_2001_period2

dpb_hip_18_pct4_50_to_75_2001_period2

dpb_hip_18_pct4_25_to_50_2001_period2

dpb_hip_18_pct4_b25_2001_period2

dpb_con_18_pct4_b25_2001_period2 <- dygraph(pb_con_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_con_18_pct4_25_to_50_2001_period2 <- dygraph(pb_con_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_con_18_pct4_50_to_75_2001_period2 <- dygraph(pb_con_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_con_18_pct4_a75_2001_period2 <- dygraph(pb_con_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dpb_con_18_pct4_a75_2001_period2

dpb_con_18_pct4_50_to_75_2001_period2

dpb_con_18_pct4_25_to_50_2001_period2

dpb_con_18_pct4_b25_2001_period2

```



# Exportaciones
## Concentracion de exportaciones

Índice de Herfindahl, concentración al interior de los 10 principales productos 
de cada país, en cada año.

```{r exp_imp_make_dfs}
# load("./produced_data/data_with_basic_wrangling/cs_x_m_10_ppales")
load(paste0(pre_path, 
            "produced_data/data_with_basic_wrangling/cs_x_m_10_ppales"))


exp_10_ppales <- cs_x_m_10_ppales %>%
  unite(productos_principales,  starts_with("Produ")) %>% 
  mutate(productos_principales = str_replace_all(productos_principales,
                                                 "_", "") %>% 
           str_replace_all("n/a", "") %>% 
           str_replace_all("NA", ""))
  
exp_10_ppales_by_iso <- exp_10_ppales %>% 
  mutate(year_as_date = as.Date(as.character(year), format = "%Y")) %>% 
  group_by(iso3c, year_as_date) %>% 
  summarise(concentracion = conc(valor, type = "Herfindahl")) %>% 
  arrange(iso3c, year_as_date)  
    


```


### Latin America {.tabset}



```{r hx_make_dfs_18, include=TRUE}
hx_18 <- exp_10_ppales_by_iso%>% 
  filter(iso3c %in% coi_18)

hx_18_xts <- cate_gen_to_xts_wide(hx_18 %>% select(iso3c, year_as_date, concentracion),
                                  value_col_name = "concentracion",
                                  is_full = TRUE, is_med = FALSE,
                                  dating_col_name = "year_as_date")

hx_18_class_pct4_1990_2001_2015 <- cate_gen(hx_18 %>% 
    select(iso3c, year_as_date, concentracion), value_col_name = "concentracion", time_breaks = default_time_break, is_med = FALSE, is_pct3 = FALSE, is_pct4 = TRUE, dating_col_name = "year_as_date")

hx_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(hx_18_class_pct4_1990_2001_2015[[2]], 
    value_col_name = "concentracion", is_med = FALSE, is_pct4 = TRUE, dating_col_name = "year_as_date")

```

#### All (18) countries
```{r hx_make_dygraph_18}
#using dygraph
dhx_title_18 <- "Export concentration, Herfindahl index (E18)"

dhx_18 <- dygraph(hx_18_xts, main = dhx_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dhx_18
```

#### Countries sorted into quartiles of the Y-axis variable


```{r hx_make_dygraph_18_2001_pct25_50_75_period2}
dhx_18_pct4_b25_2001_period2 <- dygraph(
  hx_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dhx_18_pct4_25_to_50_2001_period2 <- dygraph(hx_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dhx_18_pct4_50_to_75_2001_period2 <- dygraph(hx_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dhx_18_pct4_a75_2001_period2 <- dygraph(hx_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dhx_18_pct4_a75_2001_period2

dhx_18_pct4_50_to_75_2001_period2

dhx_18_pct4_25_to_50_2001_period2

dhx_18_pct4_b25_2001_period2

```


## Shares en exportaciones de 3 categorías a priori

Datos mensuales, promediados por año

```{r shares_exp_3_cat}
# load("./produced_data/data_with_basic_wrangling/x_m_locations_products_tidy")
load(paste0(pre_path, 
            "produced_data/data_with_basic_wrangling/x_m_locations_products_tidy"))

imp_by_prod_to_join <- imp_by_prod_tidy %>% 
   filter(iso3c %in% coi) %>% 
  rename(producto_m = producto) 

exp_by_prod_to_join <- exp_by_prod_tidy %>% 
   filter(iso3c %in% coi) %>% 
  rename(producto_x = producto) %>% 
  mutate(producto_x = stri_trans_general(producto_x, "Latin-ASCII") %>% 
           str_to_lower() %>% str_replace_all(" ", "_"))

exp_by_prod_wide <- exp_by_prod_to_join %>% 
   filter(iso3c %in% coi) %>% 
  spread(producto_x, value) %>% 
  mutate(agro_agropec_share = productos_agricolas_y_agropecuarios/total,
         mineria_y_petro_share = mineria_y_petroleo/total,
         manufacturas_share = manufacturas/total) %>% 
  select(-c(productos_agricolas_y_agropecuarios,mineria_y_petroleo,
            manufacturas))

exp_by_prod_wide_anual <- exp_by_prod_wide %>% 
  mutate(year = year(date)) %>% 
  group_by(iso3c, year) %>% 
  mutate(avg_share_agr = mean(agro_agropec_share, rm.na = TRUE),
         avg_share_min_pet = mean(mineria_y_petro_share, rm.na = TRUE),
         avg_share_manuf = mean(manufacturas_share, rm.na = TRUE)) %>% 
  arrange(year, desc(avg_share_min_pet))


exp_by_prod_shares <- exp_by_prod_wide_anual %>% 
  rename(agro_pec=agro_agropec_share, mineria_y_petro=mineria_y_petro_share,
         manuf=manufacturas_share) %>% 
  gather(key = product, value = share, agro_pec, mineria_y_petro, manuf ) %>% 
  select(-c(avg_share_agr, avg_share_min_pet, avg_share_manuf, total)) %>% 
  arrange(iso3c, year, product)

exp_by_prod_shares_anual_avg <- exp_by_prod_shares %>% 
  mutate(year_as_date = as.Date(as.character(year), format = "%Y")) %>% 
  group_by(iso3c, year_as_date, product) %>% 
  summarise(share_anual = mean(share, rm.na=TRUE)) 

exp_agro_pec_shares_anual_avg <- exp_by_prod_shares_anual_avg %>% 
  filter(product == "agro_pec")


exp_manuf_shares_anual_avg <- exp_by_prod_shares_anual_avg %>% 
  filter(product == "manuf")

exp_mineria_y_petro_pec_shares_anual_avg <- exp_by_prod_shares_anual_avg %>% 
  filter(product == "mineria_y_petro")

```


### Latin America {.tabset}



```{r xshares_make_dfs_18, include=TRUE}
minsh_18 <- exp_mineria_y_petro_pec_shares_anual_avg  %>% 
  filter(iso3c %in% coi_18)

# minsh_18_xts <- cate_gen_to_xts_wide(minsh_18 %>% select(iso3c, year_as_date, share_anual),
#                                   value_col_name = "share_anual",
#                                   is_full = TRUE, is_med = FALSE,
#                                   dating_col_name = "year_as_date")

minsh_18_sp <- minsh_18 %>% select(iso3c, year_as_date, share_anual) %>% spread(key = iso3c, value = share_anual)
minsh_18_xts <- minsh_18_sp %>% select(- year_as_date) %>% xts(order.by = minsh_18_sp$year_as_date) 
minsh_18_xts$year_as_date <- NULL



minsh_18_class_pct4_1990_2001_2015 <- cate_gen(minsh_18 %>% 
    select(iso3c, year_as_date, share_anual), value_col_name = "share_anual",
    time_breaks = default_time_break, is_med = FALSE,  is_pct4 = TRUE, dating_col_name = "year_as_date")

minsh_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(minsh_18_class_pct4_1990_2001_2015[[2]], 
    value_col_name = "share_anual", is_med = FALSE, is_pct4 = TRUE, dating_col_name = "year_as_date")


manush_18 <- exp_manuf_shares_anual_avg  %>% 
  filter(iso3c %in% coi_18)

manush_18_sp <- manush_18 %>% select(iso3c, year_as_date, share_anual) %>% spread(key = iso3c, value = share_anual)
manush_18_xts <- manush_18_sp %>% select(- year_as_date) %>% xts(order.by = minsh_18_sp$year_as_date) 
manush_18_xts$year_as_date <- NULL

# 
# manush_18_xts <- cate_gen_to_xts_wide(manush_18 %>% select(iso3c, year_as_date, share_anual),
#                                   value_col_name = "share_anual",
#                                   is_full = TRUE, is_med = FALSE,
#                                   dating_col_name = "year_as_date")

manush_18_class_pct4_1990_2001_2015 <- cate_gen(manush_18 %>% 
    select(iso3c, year_as_date, share_anual), value_col_name = "share_anual",
    time_breaks = default_time_break, is_med = FALSE,  is_pct4 = TRUE, dating_col_name = "year_as_date")

manush_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(manush_18_class_pct4_1990_2001_2015[[2]], 
    value_col_name = "share_anual", is_med = FALSE, is_pct4 = TRUE, dating_col_name = "year_as_date")


agropec_18 <- exp_agro_pec_shares_anual_avg %>% 
  filter(iso3c %in% coi_18)

agropec_18_xts <- cate_gen_to_xts_wide(agropec_18 %>% select(iso3c, year_as_date, share_anual),
                                  value_col_name = "share_anual",
                                  is_full = TRUE, is_med = FALSE,
                                  dating_col_name = "year_as_date")

agropec_18_class_pct4_1990_2001_2015 <- cate_gen(agropec_18 %>% 
    select(iso3c, year_as_date, share_anual), value_col_name = "share_anual",
    time_breaks = default_time_break, is_med = FALSE,  is_pct4 = TRUE, dating_col_name = "year_as_date")

agropec_18_pct4_1990_2001_2015_xts_2 <- cate_gen_to_xts_wide(agropec_18_class_pct4_1990_2001_2015[[2]], 
    value_col_name = "share_anual", is_med = FALSE, is_pct4 = TRUE, dating_col_name = "year_as_date")

```


#### All (18) countries
```{r xshares_make_dygraph_18}
dminsh_title_18 <- "Export shares, mining and oil (E18)"

dminsh_18 <- dygraph(minsh_18_xts, main = dminsh_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dminsh_18

dagropec_title_18 <- "Export shares, agro and agropec (E18)"

dagropec_18 <- dygraph(agropec_18_xts, main = dagropec_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dagropec_18


dmanush_title_18 <- "Export shares, manufactures (E18)"

dmanush_18 <- dygraph(manush_18_xts, main = dmanush_title_18) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)
dmanush_18

```


#### Countries sorted into quartiles of the Y-axis variable


```{r manush_make_dygraph_18_2001_pct25_50_75_period2}
dmanush_18_pct4_b25_2001_period2 <- dygraph(
  manush_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dmanush_18_pct4_25_to_50_2001_period2 <- dygraph(manush_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dmanush_18_pct4_50_to_75_2001_period2 <- dygraph(manush_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dmanush_18_pct4_a75_2001_period2 <- dygraph(manush_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dmanush_18_pct4_a75_2001_period2

dmanush_18_pct4_50_to_75_2001_period2

dmanush_18_pct4_25_to_50_2001_period2

dmanush_18_pct4_b25_2001_period2


dagropec_18_pct4_b25_2001_period2 <- dygraph(
  agropec_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dagropec_18_pct4_25_to_50_2001_period2 <- dygraph(agropec_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dagropec_18_pct4_50_to_75_2001_period2 <- dygraph(agropec_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dagropec_18_pct4_a75_2001_period2 <- dygraph(agropec_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dagropec_18_pct4_a75_2001_period2

dagropec_18_pct4_50_to_75_2001_period2

dagropec_18_pct4_25_to_50_2001_period2

dagropec_18_pct4_b25_2001_period2


dminsh_18_pct4_b25_2001_period2 <- dygraph(
  minsh_18_pct4_1990_2001_2015_xts_2[["below_p25"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dminsh_18_pct4_25_to_50_2001_period2 <- dygraph(minsh_18_pct4_1990_2001_2015_xts_2[["p25_to_50"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dminsh_18_pct4_50_to_75_2001_period2 <- dygraph(minsh_18_pct4_1990_2001_2015_xts_2[["p50_to_75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dminsh_18_pct4_a75_2001_period2 <- dygraph(minsh_18_pct4_1990_2001_2015_xts_2[["above_p75"]]) %>%
  dyRangeSelector() %>%
dyHighlight(highlightCircleSize = 4,
            highlightSeriesBackgroundAlpha = 0.3,
            hideOnMouseOut = FALSE)

dminsh_18_pct4_a75_2001_period2

dminsh_18_pct4_50_to_75_2001_period2

dminsh_18_pct4_25_to_50_2001_period2

dminsh_18_pct4_b25_2001_period2


```


